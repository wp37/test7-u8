<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ezteach Quiz - [TI√äU ƒê·ªÄ B√ÄI KI·ªÇM TRA]</title>
    <meta name="description" content="B√†i ki·ªÉm tra tr·∫Øc nghi·ªám - Ezteach">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 'inter': ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
        }

        .option-btn {
            transition: all 0.3s ease;
        }

        .option-btn:hover:not(.selected) {
            transform: translateX(8px);
            border-color: #6366f1;
            background-color: #eef2ff;
        }

        .option-btn.selected {
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            color: white;
            border-color: transparent;
        }

        .progress-bar {
            background: linear-gradient(90deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
        }

        .score-circle {
            background: conic-gradient(#6366f1 var(--score-percent), #e5e7eb 0deg);
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            animation: fall 3s linear forwards;
            pointer-events: none;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(720deg);
            }
        }

        .timer-warning {
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }
    </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-900">
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-20 left-10 w-72 h-72 bg-indigo-500/20 rounded-full blur-3xl animate-pulse"></div>
        <div class="absolute bottom-20 right-10 w-96 h-96 bg-purple-500/20 rounded-full blur-3xl animate-pulse"></div>
    </div>

    <div class="relative z-10 container mx-auto px-4 py-8 max-w-2xl">
        <header class="text-center mb-8">
            <div class="inline-flex items-center gap-3 bg-white/10 backdrop-blur-lg px-6 py-3 rounded-full mb-4">
                <span class="text-3xl">üìö</span>
                <span class="text-white font-bold text-lg">Ezteach</span>
            </div>
            <!-- ===== THAY ƒê·ªîI TI√äU ƒê·ªÄ ===== -->
            <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-2">
                Unit 7: <span
                    class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-400">Traffic</span>
            </h1>
            <p class="text-indigo-200 text-sm">Global Success 7 - B√†i ki·ªÉm tra tr·∫Øc nghi·ªám</p>
        </header>

        <!-- Locked Screen -->
        <section id="lockedScreen" class="hidden">
            <div class="glass-card rounded-3xl shadow-2xl overflow-hidden">
                <div class="bg-gradient-to-br from-gray-600 to-gray-800 p-8 text-center">
                    <div class="inline-flex items-center justify-center w-20 h-20 bg-white/20 rounded-full mb-4">
                        <span class="text-4xl">üîí</span>
                    </div>
                    <h2 class="text-2xl font-bold text-white mb-2">B√†i ki·ªÉm tra ch∆∞a m·ªü</h2>
                    <p class="text-gray-200">Vui l√≤ng quay l·∫°i ƒë√∫ng gi·ªù</p>
                </div>
                <div class="p-8 text-center">
                    <div class="bg-indigo-50 rounded-2xl p-6 mb-6">
                        <div class="text-lg text-gray-600 mb-2">‚è∞ Th·ªùi gian m·ªü b√†i:</div>
                        <!-- ===== THAY ƒê·ªîI HI·ªÇN TH·ªä TH·ªúI GIAN ===== -->
                        <div class="text-3xl font-extrabold text-indigo-600 mb-2">19:00 - Th·ª© B·∫£y</div>
                        <div class="text-xl font-bold text-purple-600">07/02/2026</div>
                    </div>
                    <div id="countdownToOpen" class="text-gray-600">
                        <div class="text-sm mb-2">C√≤n l·∫°i:</div>
                        <div id="countdownDisplay" class="text-2xl font-bold text-indigo-600">--:--:--</div>
                    </div>
                    <div class="mt-6 p-4 bg-amber-50 border border-amber-200 rounded-xl">
                        <p class="text-amber-800 text-sm">
                            <span class="font-bold">‚ö†Ô∏è L∆∞u √Ω:</span> B√†i ki·ªÉm tra ch·ªâ m·ªü trong <strong>15 ph√∫t</strong>.
                            H√£y quay l·∫°i ƒë√∫ng gi·ªù!
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Expired Screen -->
        <section id="expiredScreen" class="hidden">
            <div class="glass-card rounded-3xl shadow-2xl overflow-hidden">
                <div class="bg-gradient-to-br from-red-500 to-red-700 p-8 text-center">
                    <div class="inline-flex items-center justify-center w-20 h-20 bg-white/20 rounded-full mb-4">
                        <span class="text-4xl">‚è∞</span>
                    </div>
                    <h2 class="text-2xl font-bold text-white mb-2">ƒê√£ h·∫øt th·ªùi gian</h2>
                    <p class="text-red-100">B√†i ki·ªÉm tra ƒë√£ ƒë√≥ng</p>
                </div>
                <div class="p-8 text-center">
                    <p class="text-gray-600 mb-4">Th·ªùi gian l√†m b√†i ƒë√£ k·∫øt th√∫c.</p>
                    <p class="text-gray-600">Vui l√≤ng li√™n h·ªá gi√°o vi√™n n·∫øu b·∫°n c√≥ l√Ω do ch√≠nh ƒë√°ng.</p>
                    <div class="mt-6 flex gap-3 justify-center">
                        <a href="https://zalo.me/0914666040"
                            class="px-6 py-3 bg-blue-500 text-white font-semibold rounded-xl hover:bg-blue-600 transition-all">üí¨
                            Li√™n h·ªá Zalo</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Start Screen -->
        <section id="startScreen" class="hidden">
            <div class="glass-card rounded-3xl shadow-2xl overflow-hidden">
                <div class="gradient-bg p-8 text-center">
                    <div class="inline-flex items-center justify-center w-20 h-20 bg-white/20 rounded-full mb-4">
                        <span class="text-4xl">üöó</span>
                    </div>
                    <h2 class="text-2xl font-bold text-white mb-2">S·∫µn s√†ng ki·ªÉm tra?</h2>
                    <!-- ===== THAY ƒê·ªîI S·ªê C√ÇU V√Ä TH·ªúI GIAN ===== -->
                    <p class="text-indigo-100">20 c√¢u h·ªèi ‚Ä¢ 15 ph√∫t</p>
                </div>
                <div class="p-8">
                    <div class="grid grid-cols-3 gap-4 mb-6">
                        <div class="text-center p-4 bg-indigo-50 rounded-2xl">
                            <div class="text-2xl mb-1">üìù</div>
                            <div class="text-2xl font-bold text-indigo-600">20</div>
                            <div class="text-xs text-gray-500">C√¢u h·ªèi</div>
                        </div>
                        <div class="text-center p-4 bg-purple-50 rounded-2xl">
                            <div class="text-2xl mb-1">‚è±Ô∏è</div>
                            <div class="text-2xl font-bold text-purple-600">15</div>
                            <div class="text-xs text-gray-500">Ph√∫t</div>
                        </div>
                        <div class="text-center p-4 bg-pink-50 rounded-2xl">
                            <div class="text-2xl mb-1">üéØ</div>
                            <div class="text-2xl font-bold text-pink-600">10</div>
                            <div class="text-xs text-gray-500">ƒêi·ªÉm t·ªëi ƒëa</div>
                        </div>
                    </div>
                    <div class="bg-amber-50 border border-amber-200 rounded-xl p-4 mb-6">
                        <p class="text-amber-800 text-sm">
                            <span class="font-bold">‚ö†Ô∏è L∆∞u √Ω:</span> B√†i ki·ªÉm tra s·∫Ω t·ª± ƒë·ªông n·ªôp khi h·∫øt th·ªùi gian. ƒê√°p
                            √°n s·∫Ω ƒë∆∞·ª£c gi√°o vi√™n th√¥ng b√°o sau.
                        </p>
                    </div>
                    <form id="studentForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">üë§ H·ªç v√† t√™n h·ªçc sinh</label>
                            <input type="text" id="studentName" required
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 outline-none text-gray-700"
                                placeholder="Nh·∫≠p h·ªç v√† t√™n...">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">üè´ L·ªõp</label>
                            <input type="text" id="studentClass" required
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 outline-none text-gray-700"
                                placeholder="V√≠ d·ª•: 7A1">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">üì± S·ªë ƒëi·ªán tho·∫°i ph·ª• huynh
                                <span class="text-red-500">*</span></label>
                            <input type="tel" id="parentPhone" required pattern="[0-9]{10,11}"
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 outline-none text-gray-700"
                                placeholder="Nh·∫≠p SƒêT cha/m·∫π (VD: 0912345678)">
                            <p class="text-xs text-gray-500 mt-1">K·∫øt qu·∫£ s·∫Ω ƒë∆∞·ª£c g·ª≠i ƒë·∫øn ph·ª• huynh ƒë·ªÉ x√°c nh·∫≠n</p>
                        </div>
                        <button type="submit"
                            class="w-full py-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold text-lg rounded-xl shadow-lg hover:shadow-xl hover:scale-[1.02] active:scale-[0.98] transition-all">
                            üöÄ B·∫Øt ƒë·∫ßu l√†m b√†i
                        </button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Quiz Screen -->
        <section id="quizScreen" class="hidden">
            <div class="glass-card rounded-2xl p-4 mb-4 shadow-lg">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <span class="text-2xl">‚è±Ô∏è</span>
                        <span class="text-gray-600 font-medium">Th·ªùi gian c√≤n l·∫°i:</span>
                    </div>
                    <div id="timerDisplay" class="text-2xl font-bold text-indigo-600">15:00</div>
                </div>
                <div class="mt-3 h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div id="timerBar"
                        class="h-full bg-gradient-to-r from-emerald-500 to-teal-500 rounded-full transition-all duration-1000"
                        style="width: 100%"></div>
                </div>
            </div>

            <div class="glass-card rounded-2xl p-4 mb-6 shadow-lg">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-500 rounded-full flex items-center justify-center text-white font-bold"
                            id="qNum">1</div>
                        <div>
                            <div class="text-sm text-gray-500">C√¢u h·ªèi</div>
                            <div class="font-bold text-gray-800"><span id="currentQ">1</span>/20</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm text-gray-500" id="dispName">H·ªçc sinh</div>
                        <div class="text-xs text-indigo-600 font-medium" id="dispClass">L·ªõp 7</div>
                    </div>
                </div>
                <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                    <div id="progressBar" class="h-full progress-bar rounded-full transition-all duration-500"
                        style="width: 5%"></div>
                </div>
            </div>

            <div class="glass-card rounded-3xl shadow-2xl overflow-hidden" id="questionCard">
                <div class="p-6 md:p-8">
                    <div class="flex items-start gap-4 mb-6">
                        <div class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-500 rounded-2xl flex items-center justify-center text-white font-bold text-lg shadow-lg"
                            id="qBadge">1</div>
                        <p id="questionText"
                            class="text-lg md:text-xl font-semibold text-gray-800 leading-relaxed pt-2">Loading...</p>
                    </div>
                    <div id="optionsContainer" class="space-y-3"></div>
                </div>
                <div class="px-6 md:px-8 pb-6 md:pb-8">
                    <div class="flex gap-3">
                        <button id="prevBtn"
                            class="flex-1 py-3 px-6 bg-gray-100 text-gray-700 font-semibold rounded-xl hover:bg-gray-200 transition-all disabled:opacity-50"
                            disabled>‚Üê Tr∆∞·ªõc</button>
                        <button id="nextBtn"
                            class="flex-1 py-3 px-6 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold rounded-xl hover:shadow-lg transition-all">Ti·∫øp
                            ‚Üí</button>
                        <button id="submitBtn"
                            class="hidden flex-1 py-3 px-6 bg-gradient-to-r from-emerald-500 to-teal-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all">‚úì
                            N·ªôp b√†i</button>
                    </div>
                </div>
            </div>

            <div class="glass-card rounded-2xl p-4 mt-6 shadow-lg">
                <div class="text-sm text-gray-500 mb-3 font-medium">ƒêi·ªÅu h∆∞·ªõng c√¢u h·ªèi:</div>
                <div id="questionNav" class="flex flex-wrap gap-2"></div>
            </div>
        </section>

        <!-- Result Screen -->
        <section id="resultScreen" class="hidden">
            <div class="glass-card rounded-3xl shadow-2xl overflow-hidden">
                <div id="resultHeader" class="p-8 text-center gradient-bg">
                    <div class="relative inline-block mb-4">
                        <div class="w-32 h-32 rounded-full score-circle flex items-center justify-center"
                            style="--score-percent: 0deg;">
                            <div class="w-28 h-28 bg-white rounded-full flex flex-col items-center justify-center">
                                <span id="scoreDisplay" class="text-4xl font-extrabold text-indigo-600">0</span>
                                <span class="text-gray-400 text-sm">/10 ƒëi·ªÉm</span>
                            </div>
                        </div>
                    </div>
                    <h2 id="resultTitle" class="text-2xl font-bold text-white mb-2">K·∫øt qu·∫£</h2>
                    <p id="resultMessage" class="text-indigo-100">ƒêang t√≠nh ƒëi·ªÉm...</p>
                </div>
                <div class="p-8">
                    <div class="grid grid-cols-3 gap-4 mb-6">
                        <div class="text-center p-4 bg-emerald-50 rounded-2xl border-2 border-emerald-100">
                            <div class="text-2xl mb-1">‚úÖ</div>
                            <div id="correctCount" class="text-2xl font-bold text-emerald-600">0</div>
                            <div class="text-xs text-gray-500">ƒê√∫ng</div>
                        </div>
                        <div class="text-center p-4 bg-red-50 rounded-2xl border-2 border-red-100">
                            <div class="text-2xl mb-1">‚ùå</div>
                            <div id="incorrectCount" class="text-2xl font-bold text-red-500">0</div>
                            <div class="text-xs text-gray-500">Sai</div>
                        </div>
                        <div class="text-center p-4 bg-indigo-50 rounded-2xl border-2 border-indigo-100">
                            <div class="text-2xl mb-1">üìä</div>
                            <div id="percentDisplay" class="text-2xl font-bold text-indigo-600">0%</div>
                            <div class="text-xs text-gray-500">T·ª∑ l·ªá</div>
                        </div>
                    </div>
                    <div id="submitStatus" class="text-center mb-4 py-2 px-4 rounded-lg text-sm font-medium"></div>
                    <div class="bg-blue-50 border border-blue-200 rounded-xl p-4 mb-4">
                        <p class="text-blue-800 text-sm text-center">
                            üìã ƒê√°p √°n chi ti·∫øt s·∫Ω ƒë∆∞·ª£c gi√°o vi√™n th√¥ng b√°o sau bu·ªïi ki·ªÉm tra.
                        </p>
                    </div>
                    <div class="bg-emerald-50 border border-emerald-200 rounded-xl p-4 mb-4">
                        <p class="text-emerald-800 text-sm text-center">
                            üì± K·∫øt qu·∫£ ƒë√£ ƒë∆∞·ª£c g·ª≠i v·ªÅ s·ªë ƒëi·ªán tho·∫°i ph·ª• huynh: <strong id="resultPhone">---</strong>
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <footer class="text-center mt-8 text-indigo-300/60 text-sm">
            <p>¬© 2026 Ezteach - Th·∫ßy V√µ Ng·ªçc T√πng</p>
            <p class="mt-1">
                <a href="https://zalo.me/0914666040" class="hover:text-indigo-300">üí¨ Zalo</a>
                <span class="mx-2">‚Ä¢</span>
                <a href="https://facebook.com/vongoctungthcs" class="hover:text-indigo-300">üìò Facebook</a>
            </p>
        </footer>
    </div>

    <script>
        // ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
        // ‚ïë                     C·∫§U H√åNH B√ÄI KI·ªÇM TRA                      ‚ïë
        // ‚ïë        THAY ƒê·ªîI C√ÅC GI√Å TR·ªä D∆Ø·ªöI ƒê√ÇY CHO M·ªñI ƒê·ªÄ M·ªöI           ‚ïë
        // ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

        // ===== 1. GOOGLE SHEETS URL =====
        // Thay URL n√†y b·∫±ng URL Google Apps Script c·ªßa b·∫°n
        const GOOGLE_SCRIPT_URL = 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE';

        // ===== 2. TH·ªúI GIAN L√ÄM B√ÄI =====
        // ƒê·ªïi s·ªë ph√∫t t·∫°i ƒë√¢y (VD: 10, 15, 20, 30)
        const QUIZ_TIME = 15 * 60; // 15 ph√∫t

        // ===== 3. KH√ìA TH·ªúI GIAN L√ÄM B√ÄI =====
        // Format: 'YYYY-MM-DDTHH:MM:SS+07:00'
        // VD: '2026-02-07T19:00:00+07:00' = 19h ng√†y 7/2/2026

        // Th·ªùi gian M·ªû b√†i (h·ªçc sinh c√≥ th·ªÉ b·∫Øt ƒë·∫ßu v√†o l√†m)
        const OPEN_TIME = new Date('2026-02-07T19:00:00+07:00');

        // Th·ªùi gian ƒê√ìNG c·ªïng v√†o (kh√¥ng cho v√†o n·ªØa, ai ƒëang l√†m v·∫´n ti·∫øp t·ª•c)
        const CLOSE_TIME = new Date('2026-02-07T19:15:00+07:00');

        // ===== 4. C√ÇU H·ªéI TR·∫ÆC NGHI·ªÜM =====
        // Format: { id, question, options: [A, B, C, D], correct: 0-3 }
        // correct: 0 = A, 1 = B, 2 = C, 3 = D
        const quizData = [
            { id: 1, question: "C√¢u h·ªèi 1?", options: ["ƒê√°p √°n A", "ƒê√°p √°n B", "ƒê√°p √°n C", "ƒê√°p √°n D"], correct: 0 },
            { id: 2, question: "C√¢u h·ªèi 2?", options: ["ƒê√°p √°n A", "ƒê√°p √°n B", "ƒê√°p √°n C", "ƒê√°p √°n D"], correct: 1 },
            // Th√™m c√°c c√¢u h·ªèi kh√°c...
        ];

        // ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
        // ‚ïë              KH√îNG C·∫¶N S·ª¨A CODE PH√çA D∆Ø·ªöI                      ‚ïë
        // ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

        // ===== STATE =====
        let state = { name: '', className: '', parentPhone: '', current: 0, answers: {}, submitted: false };
        let timeLeft = QUIZ_TIME;
        let timerInterval = null;
        let countdownInterval = null;

        // ===== DOM =====
        const $ = id => document.getElementById(id);
        const lockedScreen = $('lockedScreen');
        const expiredScreen = $('expiredScreen');
        const startScreen = $('startScreen');
        const quizScreen = $('quizScreen');
        const resultScreen = $('resultScreen');

        // ===== INIT =====
        document.addEventListener('DOMContentLoaded', () => {
            checkSchedule();
            $('studentForm').onsubmit = handleStart;
            $('prevBtn').onclick = () => navigate(-1);
            $('nextBtn').onclick = () => navigate(1);
            $('submitBtn').onclick = handleSubmit;
        });

        // ===== SCHEDULE CHECK =====
        function checkSchedule() {
            const now = new Date();
            if (now < OPEN_TIME) { showScreen('locked'); startCountdown(); }
            else if (now > CLOSE_TIME) { showScreen('expired'); }
            else { showScreen('start'); }
        }

        function showScreen(screen) {
            lockedScreen.classList.add('hidden');
            expiredScreen.classList.add('hidden');
            startScreen.classList.add('hidden');
            quizScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');

            if (screen === 'locked') lockedScreen.classList.remove('hidden');
            else if (screen === 'expired') expiredScreen.classList.remove('hidden');
            else if (screen === 'start') startScreen.classList.remove('hidden');
            else if (screen === 'quiz') quizScreen.classList.remove('hidden');
            else if (screen === 'result') resultScreen.classList.remove('hidden');
        }

        function startCountdown() {
            updateCountdown();
            countdownInterval = setInterval(() => {
                const now = new Date();
                if (now >= OPEN_TIME) { clearInterval(countdownInterval); checkSchedule(); }
                else { updateCountdown(); }
            }, 1000);
        }

        function updateCountdown() {
            const now = new Date();
            const diff = OPEN_TIME - now;
            if (diff <= 0) return;

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);

            let display = '';
            if (days > 0) display += `${days} ng√†y `;
            display += `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            $('countdownDisplay').textContent = display;
        }

        function handleStart(e) {
            e.preventDefault();
            const now = new Date();
            if (now < OPEN_TIME || now > CLOSE_TIME) { checkSchedule(); return; }

            state.name = $('studentName').value.trim();
            state.className = $('studentClass').value.trim();
            state.parentPhone = $('parentPhone').value.trim();

            if (!state.name || !state.className) return alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!');
            if (!state.parentPhone || !/^[0-9]{10,11}$/.test(state.parentPhone)) {
                return alert('Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i ph·ª• huynh h·ª£p l·ªá (10-11 s·ªë)!');
            }

            $('dispName').textContent = state.name;
            $('dispClass').textContent = 'L·ªõp ' + state.className;
            initNav();
            render();
            startTimer();
            showScreen('quiz');
        }

        // ===== TIMER =====
        function startTimer() {
            timeLeft = QUIZ_TIME;
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0) { clearInterval(timerInterval); autoSubmit(); }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const display = $('timerDisplay');
            display.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            const percent = (timeLeft / QUIZ_TIME) * 100;
            $('timerBar').style.width = percent + '%';

            if (timeLeft <= 60) {
                display.className = 'text-2xl font-bold text-red-600 timer-warning';
                $('timerBar').className = 'h-full bg-gradient-to-r from-red-500 to-red-600 rounded-full transition-all duration-1000';
            } else if (timeLeft <= 180) {
                display.className = 'text-2xl font-bold text-amber-600';
                $('timerBar').className = 'h-full bg-gradient-to-r from-amber-500 to-orange-500 rounded-full transition-all duration-1000';
            }
        }

        function autoSubmit() {
            if (state.submitted) return;
            alert('‚è∞ H·∫øt gi·ªù! B√†i l√†m c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c t·ª± ƒë·ªông n·ªôp.');
            state.submitted = true;
            showResults();
        }

        function initNav() {
            const nav = $('questionNav');
            nav.innerHTML = '';
            quizData.forEach((_, i) => {
                const btn = document.createElement('button');
                btn.className = 'w-9 h-9 rounded-lg font-semibold text-sm border-2 border-gray-200 bg-white text-gray-600 hover:border-indigo-400 hover:bg-indigo-50 transition-all';
                btn.textContent = i + 1;
                btn.onclick = () => { state.current = i; render(); };
                nav.appendChild(btn);
            });
        }

        function updateNav() {
            Array.from($('questionNav').children).forEach((btn, i) => {
                btn.className = 'w-9 h-9 rounded-lg font-semibold text-sm border-2 transition-all ';
                if (i === state.current) btn.className += 'bg-indigo-600 text-white border-indigo-600';
                else if (state.answers[i] !== undefined) btn.className += 'bg-emerald-500 text-white border-emerald-500';
                else btn.className += 'bg-white text-gray-600 border-gray-200 hover:border-indigo-400 hover:bg-indigo-50';
            });
        }

        function render() {
            const q = quizData[state.current];
            const total = quizData.length;

            $('qNum').textContent = state.current + 1;
            $('qBadge').textContent = state.current + 1;
            $('currentQ').textContent = state.current + 1;
            $('questionText').textContent = q.question;
            $('progressBar').style.width = ((state.current + 1) / total * 100) + '%';

            const container = $('optionsContainer');
            container.innerHTML = '';
            const letters = ['A', 'B', 'C', 'D'];

            q.options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn w-full p-4 text-left rounded-xl border-2 border-gray-200 flex items-center gap-4 bg-white';
                if (state.answers[state.current] === i) btn.classList.add('selected');
                btn.innerHTML = `<span class="flex-shrink-0 w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center font-bold text-gray-600">${letters[i]}</span><span class="font-medium text-gray-700">${opt}</span>`;
                btn.onclick = () => { if (!state.submitted) { state.answers[state.current] = i; render(); } };
                container.appendChild(btn);
            });

            $('prevBtn').disabled = state.current === 0;
            $('nextBtn').classList.toggle('hidden', state.current === total - 1);
            $('submitBtn').classList.toggle('hidden', state.current !== total - 1);
            updateNav();
        }

        function navigate(dir) {
            const newIdx = state.current + dir;
            if (newIdx >= 0 && newIdx < quizData.length) { state.current = newIdx; render(); }
        }

        function handleSubmit() {
            const answered = Object.keys(state.answers).length;
            if (answered < quizData.length && !confirm(`B·∫°n c√≤n ${quizData.length - answered} c√¢u ch∆∞a tr·∫£ l·ªùi. N·ªôp b√†i?`)) return;
            if (answered === quizData.length && !confirm('B·∫°n c√≥ ch·∫Øc mu·ªën n·ªôp b√†i?')) return;

            clearInterval(timerInterval);
            state.submitted = true;
            showResults();
        }

        function showResults() {
            let correct = 0;
            quizData.forEach((q, i) => { if (state.answers[i] === q.correct) correct++; });

            const total = quizData.length;
            const score = (correct / total * 10).toFixed(1);
            const percent = Math.round(correct / total * 100);

            $('scoreDisplay').textContent = score;
            $('correctCount').textContent = correct;
            $('incorrectCount').textContent = total - correct;
            $('percentDisplay').textContent = percent + '%';
            $('resultPhone').textContent = state.parentPhone;

            setTimeout(() => {
                document.querySelector('.score-circle').style.setProperty('--score-percent', (correct / total * 360) + 'deg');
            }, 100);

            const header = $('resultHeader');
            let title, msg, gradient;
            if (parseFloat(score) >= 9) { title = 'üèÜ Xu·∫•t s·∫Øc!'; msg = 'Tuy·ªát v·ªùi! B·∫°n ƒë√£ l√†m ch·ªß ki·∫øn th·ª©c!'; gradient = 'bg-gradient-to-br from-amber-400 to-orange-500'; createConfetti(); }
            else if (parseFloat(score) >= 7) { title = 'üåü Gi·ªèi l·∫Øm!'; msg = 'K·∫øt qu·∫£ r·∫•t t·ªët!'; gradient = 'bg-gradient-to-br from-emerald-400 to-teal-500'; }
            else if (parseFloat(score) >= 5) { title = 'üëç Kh√° t·ªët!'; msg = 'C·ªë g·∫Øng √¥n t·∫≠p th√™m nh√©!'; gradient = 'bg-gradient-to-br from-blue-400 to-indigo-500'; }
            else { title = 'üí™ C·∫ßn c·ªë g·∫Øng!'; msg = 'H√£y xem l·∫°i b√†i h·ªçc v√† th·ª≠ l·∫°i!'; gradient = 'bg-gradient-to-br from-pink-400 to-rose-500'; }

            $('resultTitle').textContent = title;
            $('resultMessage').textContent = msg;
            header.className = 'p-8 text-center ' + gradient;

            showScreen('result');
            window.scrollTo({ top: 0, behavior: 'smooth' });
            sendToSheet(state.name, state.className, state.parentPhone, score);
        }

        function createConfetti() {
            const colors = ['#6366f1', '#8b5cf6', '#a855f7', '#ec4899', '#f43f5e', '#10b981', '#f59e0b'];
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const c = document.createElement('div');
                    c.className = 'confetti';
                    c.style.left = Math.random() * 100 + 'vw';
                    c.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    c.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    document.body.appendChild(c);
                    setTimeout(() => c.remove(), 4000);
                }, i * 50);
            }
        }

        async function sendToSheet(name, className, parentPhone, score) {
            const status = $('submitStatus');
            status.textContent = '‚è≥ ƒêang g·ª≠i k·∫øt qu·∫£...';
            status.className = 'text-center mb-4 py-2 px-4 rounded-lg text-sm font-medium bg-blue-100 text-blue-700';

            if (GOOGLE_SCRIPT_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                status.textContent = '‚ö†Ô∏è Ch∆∞a c·∫•u h√¨nh Google Sheets';
                status.className = 'text-center mb-4 py-2 px-4 rounded-lg text-sm font-medium bg-amber-100 text-amber-700';
                return;
            }

            try {
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, className, parentPhone, score })
                });
                status.textContent = '‚úÖ ƒê√£ l∆∞u k·∫øt qu·∫£ th√†nh c√¥ng!';
                status.className = 'text-center mb-4 py-2 px-4 rounded-lg text-sm font-medium bg-emerald-100 text-emerald-700';
            } catch (e) {
                status.textContent = '‚ö†Ô∏è Kh√¥ng th·ªÉ l∆∞u k·∫øt qu·∫£';
                status.className = 'text-center mb-4 py-2 px-4 rounded-lg text-sm font-medium bg-amber-100 text-amber-700';
            }
        }
    </script>
</body>

</html>